\doxysection{interruptions.\+c File Reference}
\label{interruptions_8c}\index{interruptions.c@{interruptions.c}}


Interruption handling and firmware core functions.  


{\ttfamily \#include \char`\"{}interruptions.\+h\char`\"{}}\newline
Include dependency graph for interruptions.\+c\+:
% FIG 0
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\label{interruptions_8c_a7692d8c3185943c5bdfaa6de0a172ad3}} 
{\bfseries CY\+\_\+\+ISR} (ISR\+\_\+\+RS485\+\_\+\+RX\+\_\+\+Ex\+Interrupt)
\item 
\mbox{\label{interruptions_8c_a12e640805e7293858886775516648d70}} 
{\bfseries CY\+\_\+\+ISR} (ISR\+\_\+\+BT\+\_\+\+RX\+\_\+\+Ex\+Interrupt)
\item 
\mbox{\label{interruptions_8c_a2347671848e5c23aa5df4ce2f2fd869d}} 
{\bfseries CY\+\_\+\+ISR} (ISR\+\_\+\+CYCLES\+\_\+\+Handler)
\item 
void \textbf{ interrupt\+\_\+manager} ()
\item 
void \textbf{ function\+\_\+scheduler} (void)
\item 
void \textbf{ compute\+\_\+reference} (uint8 motor\+\_\+idx, struct \textbf{ st\+\_\+ref} $\ast$st\+\_\+ref\+\_\+p, struct \textbf{ st\+\_\+ref} $\ast$st\+\_\+ref\+Old\+\_\+p)
\item 
void \textbf{ compute\+\_\+\+Soft\+Hand\+\_\+2\+\_\+motors\+\_\+joystick\+\_\+reference} (uint8 motor\+\_\+idx, struct \textbf{ st\+\_\+ref} $\ast$st\+\_\+ref\+\_\+p, struct \textbf{ st\+\_\+ref} $\ast$st\+\_\+ref\+Old\+\_\+p)
\item 
void \textbf{ compute\+\_\+\+Soft\+Hand\+\_\+2\+\_\+motors\+\_\+emg\+\_\+reference} (uint8 motor\+\_\+idx, struct \textbf{ st\+\_\+ref} $\ast$st\+\_\+ref\+\_\+p, struct \textbf{ st\+\_\+ref} $\ast$st\+\_\+ref\+Old\+\_\+p, int32 err\+\_\+emg\+\_\+1, int32 err\+\_\+emg\+\_\+2)
\item 
void \textbf{ motor\+\_\+control\+\_\+\+SH} ()
\item 
void \textbf{ motor\+\_\+control\+\_\+generic} (uint8 idx)
\item 
void \textbf{ encoder\+\_\+reading\+\_\+\+SPI} (uint8 n\+\_\+line, uint8 assoc\+\_\+motor)
\item 
void \textbf{ analog\+\_\+read\+\_\+end} ()
\item 
void \textbf{ overcurrent\+\_\+control} ()
\item 
void \textbf{ pwm\+\_\+limit\+\_\+search} (uint8 mot\+\_\+idx)
\item 
void \textbf{ cycles\+\_\+counter\+\_\+update} ()
\item 
void \textbf{ save\+\_\+cycles\+\_\+eeprom} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static const uint8 \textbf{ pwm\+\_\+preload\+\_\+values} [29]
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Interruption handling and firmware core functions. 

\begin{DoxyDate}{Date}
March 20th, 2020 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
{\itshape Centro \char`\"{}\+E.\+Piaggio\char`\"{}} 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(C) 2012-\/2016 qbrobotics. All rights reserved. 

(C) 2017-\/2020 Centro \char`\"{}\+E.\+Piaggio\char`\"{}. All rights reserved. 
\end{DoxyCopyright}


\doxysubsection{Function Documentation}
\mbox{\label{interruptions_8c_a00a8d34962a63161405e5d7785b9625e}} 
\index{interruptions.c@{interruptions.c}!analog\_read\_end@{analog\_read\_end}}
\index{analog\_read\_end@{analog\_read\_end}!interruptions.c@{interruptions.c}}
\doxysubsubsection{analog\_read\_end()}
{\footnotesize\ttfamily void analog\+\_\+read\+\_\+end (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function executes and terminates the analog readings. \mbox{\label{interruptions_8c_ab9beadac459e017e1ed807124208d132}} 
\index{interruptions.c@{interruptions.c}!compute\_reference@{compute\_reference}}
\index{compute\_reference@{compute\_reference}!interruptions.c@{interruptions.c}}
\doxysubsubsection{compute\_reference()}
{\footnotesize\ttfamily void compute\+\_\+reference (\begin{DoxyParamCaption}\item[{uint8}]{motor\+\_\+idx,  }\item[{struct \textbf{ st\+\_\+ref} $\ast$}]{st\+\_\+ref\+\_\+p,  }\item[{struct \textbf{ st\+\_\+ref} $\ast$}]{st\+\_\+ref\+Old\+\_\+p }\end{DoxyParamCaption})}

This function computes the motor reference and stores it in the given \doxyref{st\+\_\+ref}{p.}{structst__ref} structure. \mbox{\label{interruptions_8c_a32d8abb2b74c69cb1cb0e21101e61f8f}} 
\index{interruptions.c@{interruptions.c}!compute\_SoftHand\_2\_motors\_emg\_reference@{compute\_SoftHand\_2\_motors\_emg\_reference}}
\index{compute\_SoftHand\_2\_motors\_emg\_reference@{compute\_SoftHand\_2\_motors\_emg\_reference}!interruptions.c@{interruptions.c}}
\doxysubsubsection{compute\_SoftHand\_2\_motors\_emg\_reference()}
{\footnotesize\ttfamily void compute\+\_\+\+Soft\+Hand\+\_\+2\+\_\+motors\+\_\+emg\+\_\+reference (\begin{DoxyParamCaption}\item[{uint8}]{motor\+\_\+idx,  }\item[{struct \textbf{ st\+\_\+ref} $\ast$}]{st\+\_\+ref\+\_\+p,  }\item[{struct \textbf{ st\+\_\+ref} $\ast$}]{st\+\_\+ref\+Old\+\_\+p,  }\item[{int32}]{err\+\_\+emg\+\_\+1,  }\item[{int32}]{err\+\_\+emg\+\_\+2 }\end{DoxyParamCaption})}

This function computes the motor reference for Soft\+Hand\+\_\+2\+\_\+motors device with EMG input and stores it in the given \doxyref{st\+\_\+ref}{p.}{structst__ref} structure. \mbox{\label{interruptions_8c_aa34d2793dd85a2e5662e6f4dc8a3dfd2}} 
\index{interruptions.c@{interruptions.c}!compute\_SoftHand\_2\_motors\_joystick\_reference@{compute\_SoftHand\_2\_motors\_joystick\_reference}}
\index{compute\_SoftHand\_2\_motors\_joystick\_reference@{compute\_SoftHand\_2\_motors\_joystick\_reference}!interruptions.c@{interruptions.c}}
\doxysubsubsection{compute\_SoftHand\_2\_motors\_joystick\_reference()}
{\footnotesize\ttfamily void compute\+\_\+\+Soft\+Hand\+\_\+2\+\_\+motors\+\_\+joystick\+\_\+reference (\begin{DoxyParamCaption}\item[{uint8}]{motor\+\_\+idx,  }\item[{struct \textbf{ st\+\_\+ref} $\ast$}]{st\+\_\+ref\+\_\+p,  }\item[{struct \textbf{ st\+\_\+ref} $\ast$}]{st\+\_\+ref\+Old\+\_\+p }\end{DoxyParamCaption})}

This function computes the motor reference for Soft\+Hand\+\_\+2\+\_\+motors device with joystick input and stores it in the given \doxyref{st\+\_\+ref}{p.}{structst__ref} structure. \mbox{\label{interruptions_8c_a77877c16b42f6f384f7c80d3002aed22}} 
\index{interruptions.c@{interruptions.c}!cycles\_counter\_update@{cycles\_counter\_update}}
\index{cycles\_counter\_update@{cycles\_counter\_update}!interruptions.c@{interruptions.c}}
\doxysubsubsection{cycles\_counter\_update()}
{\footnotesize\ttfamily void cycles\+\_\+counter\+\_\+update (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function increases the cycles counters variables, depending on Soft\+Hand position and the current absorbed by the motor. \mbox{\label{interruptions_8c_a6eeedfdf03dd87bd2922b7005fd8c691}} 
\index{interruptions.c@{interruptions.c}!encoder\_reading\_SPI@{encoder\_reading\_SPI}}
\index{encoder\_reading\_SPI@{encoder\_reading\_SPI}!interruptions.c@{interruptions.c}}
\doxysubsubsection{encoder\_reading\_SPI()}
{\footnotesize\ttfamily void encoder\+\_\+reading\+\_\+\+SPI (\begin{DoxyParamCaption}\item[{uint8}]{n\+\_\+line,  }\item[{uint8}]{assoc\+\_\+motor }\end{DoxyParamCaption})}

This functions reads the value from all the connected encoders. \mbox{\label{interruptions_8c_a39df971c4e9f194be50c54dfd7aeabfe}} 
\index{interruptions.c@{interruptions.c}!function\_scheduler@{function\_scheduler}}
\index{function\_scheduler@{function\_scheduler}!interruptions.c@{interruptions.c}}
\doxysubsubsection{function\_scheduler()}
{\footnotesize\ttfamily void function\+\_\+scheduler (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

This function schedules the other functions in an order that optimizes the controller usage. ~\newline
 \mbox{\label{interruptions_8c_a9790811526002d99b25a814afd02cbae}} 
\index{interruptions.c@{interruptions.c}!interrupt\_manager@{interrupt\_manager}}
\index{interrupt\_manager@{interrupt\_manager}!interruptions.c@{interruptions.c}}
\doxysubsubsection{interrupt\_manager()}
{\footnotesize\ttfamily void interrupt\+\_\+manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function is called in predefined moments during firmware execution in order to unpack the received package. \mbox{\label{interruptions_8c_a4f06bfe4da34859932258358e6a9bbd2}} 
\index{interruptions.c@{interruptions.c}!motor\_control\_generic@{motor\_control\_generic}}
\index{motor\_control\_generic@{motor\_control\_generic}!interruptions.c@{interruptions.c}}
\doxysubsubsection{motor\_control\_generic()}
{\footnotesize\ttfamily void motor\+\_\+control\+\_\+generic (\begin{DoxyParamCaption}\item[{uint8}]{index }\end{DoxyParamCaption})}

This function controls the motor direction and velocity, depending on the input and control modality set. \mbox{\label{interruptions_8c_a17436ec2a3bf0398e965c63c8e1a089d}} 
\index{interruptions.c@{interruptions.c}!motor\_control\_SH@{motor\_control\_SH}}
\index{motor\_control\_SH@{motor\_control\_SH}!interruptions.c@{interruptions.c}}
\doxysubsubsection{motor\_control\_SH()}
{\footnotesize\ttfamily void motor\+\_\+control\+\_\+\+SH (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function controls the motor direction and velocity, depending on the input and control modality set. \mbox{\label{interruptions_8c_a4e92908805632dc8cab2936d89bb3ba1}} 
\index{interruptions.c@{interruptions.c}!overcurrent\_control@{overcurrent\_control}}
\index{overcurrent\_control@{overcurrent\_control}!interruptions.c@{interruptions.c}}
\doxysubsubsection{overcurrent\_control()}
{\footnotesize\ttfamily void overcurrent\+\_\+control (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function increases or decreases the pwm maximum value, depending on the current absorbed by the motor. \mbox{\label{interruptions_8c_ac7305eeb40ebfb2c0d67725aa2e88f78}} 
\index{interruptions.c@{interruptions.c}!pwm\_limit\_search@{pwm\_limit\_search}}
\index{pwm\_limit\_search@{pwm\_limit\_search}!interruptions.c@{interruptions.c}}
\doxysubsubsection{pwm\_limit\_search()}
{\footnotesize\ttfamily void pwm\+\_\+limit\+\_\+search (\begin{DoxyParamCaption}\item[{uint8}]{mot\+\_\+idx }\end{DoxyParamCaption})}

This function scales the pwm value of the motor, depending on the power supply voltage, in order to not make the motor wind too fast. \mbox{\label{interruptions_8c_ad86170580c30277d97216739e8508a13}} 
\index{interruptions.c@{interruptions.c}!save\_cycles\_eeprom@{save\_cycles\_eeprom}}
\index{save\_cycles\_eeprom@{save\_cycles\_eeprom}!interruptions.c@{interruptions.c}}
\doxysubsubsection{save\_cycles\_eeprom()}
{\footnotesize\ttfamily void save\+\_\+cycles\+\_\+eeprom (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function saves cycles counters variables into EEPROM memory. 

\doxysubsection{Variable Documentation}
\mbox{\label{interruptions_8c_aee1865719263cf20251f918e8825703d}} 
\index{interruptions.c@{interruptions.c}!pwm\_preload\_values@{pwm\_preload\_values}}
\index{pwm\_preload\_values@{pwm\_preload\_values}!interruptions.c@{interruptions.c}}
\doxysubsubsection{pwm\_preload\_values}
{\footnotesize\ttfamily const uint8 pwm\+\_\+preload\+\_\+values[29]\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{= \{100,    }
\DoxyCodeLine{                                              83,}
\DoxyCodeLine{                                              78,}
\DoxyCodeLine{                                              76,}
\DoxyCodeLine{                                              74,}
\DoxyCodeLine{                                              72,    }
\DoxyCodeLine{                                              70,}
\DoxyCodeLine{                                              68,}
\DoxyCodeLine{                                              67,}
\DoxyCodeLine{                                              65,}
\DoxyCodeLine{                                              64,    }
\DoxyCodeLine{                                              63,}
\DoxyCodeLine{                                              62,}
\DoxyCodeLine{                                              61,}
\DoxyCodeLine{                                              60,}
\DoxyCodeLine{                                              59,    }
\DoxyCodeLine{                                              58,}
\DoxyCodeLine{                                              57,}
\DoxyCodeLine{                                              56,}
\DoxyCodeLine{                                              56,}
\DoxyCodeLine{                                              55,    }
\DoxyCodeLine{                                              54,}
\DoxyCodeLine{                                              54,}
\DoxyCodeLine{                                              53,}
\DoxyCodeLine{                                              52,}
\DoxyCodeLine{                                              52,    }
\DoxyCodeLine{                                              52,}
\DoxyCodeLine{                                              51,}
\DoxyCodeLine{                                              51\}}

\end{DoxyCode}
